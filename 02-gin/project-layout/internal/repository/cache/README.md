## 手机验证登录

### 竞品分析

- 大部分公司，在你发送手机验证码之前，都要求你先验证一下，比如说利用拼图，这一步你可以猜测是防止有人恶意触发发送短信。
- 大部分公司，在你发送了一个验证码之后，都不能连续发送，要隔一段时间。
- 大部分公司，在手机号码第一次使用的时候，直接会帮你注册一个账号。
- 大部分公司，手机验证码都有有效期。
- 大部分公司，你访问不同服务，手机验证码都是独立的，例如你在 A 功能上触发了手机验证码，在B功能上可以立刻触发再次发送验证码。
- 验证码只能使用一次，也就是验证码校验通过之后，这个验证码将无法再次使用。

### 从功能和非功能的角度分析

在功能上，整个需求可以简单描述为：
- 允许用户使用手机号码接受验证码登录。在登录的时候，如果手机号码是一个全新的手机号码，那么直接注册一个新的账号。
- 手机验证码的有效期是 10 分钟。
- 用户一分钟内只能发送一次验证码。
- 用户登录/注册成功之后跳转到首页。

在非功能上：保护系统，防止攻击者恶意发送短信。

### 发送验证码流程
```
1. 开始 -> 用户输入手机号码 -> 用户点击发送验证码 -> 验证一分钟内是否发送过验证码
2. 是 -> 提示用户稍后重试 -> 结束
3. 否 -> 发送验证码 -> 结束
```

### 登录流程
```
1. 开始 -> 提交验证码 -> 验证验证码是否正确
2. 否 -> 提示验证码错误 -> 结束
3. 是 -> 是否是新用户
4. 是 -> 注册新用户 -> 登录-> 结束
5. 否 -> 登录 -> 结束
```

### 服务设计
```
1. 一个独立的短信发送服务。
2. 在独立的短信发送服务的基础上，封装一个验证码功能。
3. 在验证码功能的基础上，封装一个登录功能。
```